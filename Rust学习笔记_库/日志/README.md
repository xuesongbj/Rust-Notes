# 日志

任何中等规模的项目都应该在开发的最初阶段提供日志记录的支持。

&nbsp;

## 日志的重要性

能够从应用程序日志记录中获益良多的用户大致分为3类:

* 系统管理员：他们需要监视服务器日志中的任何故障，例如磁盘崩溃或网络故障。
* 开发人员：在开发过程中，将日志集成到项目中有助于缩短开发时间，后续还可以深入了解用户和应用程序的交互方式。
* 网络安全团队：在远程服务器遭受任何攻击的情况下，安全人员可以从日志记录中获益，因为他们可以通过跟踪被攻击服务器记录的事件日志来了解攻击是如何执行的。

&nbsp;

## 日志记录框架的特性

* 快速：日志记录框架必须确保它们在记录日志时不会执行开销昂贵的操作，并且应该尽可能少使用CPU时钟周期进行高效处理。
* 可配置的输出：仅将消息记录输出到标准输出是非常局限的。日志记录框架应该能够支持多个输出，例如文件，甚至是网络套接字。
* 日志分级：日志分级是一个可配置的过滤器，通常实现为在将日志输出发送到任何地方之前检查其类型。分级通常按照以下顺序排列，从最高优先级到最低优先级。
    
    * 错误：此级别适用于记录关键事件，以及可能导致应用程序无效输出的事件。
    * 警告：此级别适用于你已经执行评估的事件，以及希望知道何时发生时，如果它们频繁发生，则采取相应措施。
    * 信息：此级别用于正常的事件。
    * 调试：此级别用于处理调试，用于监视变量的值，以及在调试时在不同的代码路径中操作它们。
    * 跟踪：当你希望逐行执行算法或者编写的某个特定函数时，可采用此级别。
* 日志过滤：通常记录日志的特定位置，并根据事件的严重性/重要性来关闭其他日志。
* 日志轮换：日志记录框架应该提供限制日志文件大小的功能，并允许删除较旧的日志文件。
* 异步日志记录：主线程的日志记录调用可能会阻塞其他代码的运行。即使搞笑的记录器尽可能少地占用资源，它仍然会在实际代码之间阻塞I/O调用。因此，用户希望将大多数日志记录调用转移到专用的记录器线程。
* 日志消息属性：日志框架至少应该提供一些属性来记录消息。

    * 时间戳：事件发生的时间。
    * 日志级别：消息的重要性级别，例如错误、警告、信息及调试
    * 事件位置：事件在源代码中发生的位置
    * 消息：描述发生实际事件的消息

&nbsp;

## 日志记录方法

日志记录方法大致分为： 非结构化日志记录和结构化日志记录。

&nbsp;

### 非结构化日志

处理日志的常见做法是将事件记录作为纯文本字符串，并将所需的任意字段值推送到日志消息中，方法是将这些字段值转成字符串。

这种非结构化日志记录适用于大多数用例，它们没有任何可预测的格式，日志集合中检索可能非常麻烦。你需要编写匹配大量文本的正则表达式，或者在命令行用grep来获取特定事件。随着日志数量增加，这种方法最终成为日志文件获取用户信息的瓶颈。

&nbsp;

### 结构化日志

结构化日志记录定义了日志消息的结构和格式，并且每个日志消息都确保具有此格式。优势就是，日志聚合服务很容易构建索引，并向用户呈现特定事件，而不用管它们具有多少消息。

结构化日志记录不足在于，将它集成到应用程序可能需要花费一些时间，因为必须事先确定日志的层次结构和格式。
